"use strict";var _objectHasOwn=function(t,e){if(null==t)throw new TypeError("Cannot convert undefined or null to object");return Object.prototype.hasOwnProperty.call(Object(t),e)};define("bagsdk/global",[],(function(){return window})),define("bagsdk/utils/getInstanceEventBus",["jquery"],(function(t){if("function"==typeof t)return t({})})),define("bagsdk/utils/sdkInstanceAsyncLoader",["bagsdk/utils/getInstanceEventBus"],(function(t){const e={load:function(e,n,o,i){i.isBuild?o(e):(t.bagSdkInstantiated&&o(e),t.on("bagSdk:instanceReady",(function(){o(e)})))}};return e})),define("Asos.Commerce.Bag.Sdk",["bagsdk/global","bagsdk/utils/sdkInstanceAsyncLoader!dummyModuleName"],(function(t){return["asos","commerce","_bagSdkInstance"].reduce((function(t,e){if(void 0!==t)return t[e]}),t)})),define("bagsdk/config/configuration",[],(function(){return{}})),define("bagsdk/config/defaultConfiguration",["bagsdk/global"],(function(t){return{postMessageUrl:"https://"+t.location.hostname+"/bag/gateway/",bagApiUrl:"https://"+t.location.hostname+"/api",xSiteOrigin:null}})),define("bagsdk/config/currencies",[],(function(){return{"COM:GBP":"£0.00","COM:USD":"$0.00","COM:CAD":"C$0.00","COM:SEK":"SEK0.00","COM:NOK":"NOK0.00","COM:DKK":"DKK0.00","COM:CHF":"CHF0.00","COM:EUR":"€0.00","COM:AUD":"$0.00","COM:RMB":"¥0.00","COM:HKD":"HKD$0.00","COM:NZD":"NZD$0.00","COM:SGD":"SGD$0.00","COM:TWD":"NT$0.00","COM:RUB":"руб. 0.00","US:GBP":"£0.00","US:USD":"$0.00","US:CAD":"C$0.00","US:SEK":"SEK0.00","US:NOK":"NOK0.00","US:DKK":"DKK0.00","US:CHF":"CHF0.00","US:EUR":"€0.00","US:AUD":"$0.00","US:RMB":"¥0.00","US:HKD":"HKD$0.00","US:NZD":"NZD$0.00","US:SGD":"SGD$0.00","US:TWD":"NT$0.00","US:RUB":"руб. 0.00","FR:GBP":"0,00 £","FR:USD":"0,00 $","FR:CAD":"0,00 C$","FR:SEK":"0,00 SEK","FR:NOK":"0,00 NOK","FR:DKK":"0,00 DKK","FR:CHF":"0,00 CHF","FR:EUR":"0,00 €","FR:AUD":"0,00 $","FR:RMB":"0,00 ¥","FR:HKD":"0,00 HKD$","FR:NZD":"0,00 NZD$","FR:SGD":"0,00 SGD$","FR:TWD":"0,00 NT$","FR:RUB":"0,00 руб.","DE:GBP":"0,00 £","DE:USD":"0,00 $","DE:CAD":"0,00 C$","DE:SEK":"0,00 SEK","DE:NOK":"0,00 NOK","DE:DKK":"0,00 DKK","DE:CHF":"0,00 CHF","DE:EUR":"0,00 €","DE:AUD":"0,00 $","DE:RMB":"0,00 ¥","DE:HKD":"0,00 HKD$","DE:NZD":"0,00 NZD$","DE:SGD":"0,00 SGD$","DE:TWD":"0,00 NT$","DE:RUB":"0,00 руб.","IT:GBP":"£ 0,00","IT:USD":"$ 0,00","IT:CAD":"C$ 0,00","IT:SEK":"SEK 0,00","IT:NOK":"NOK 0,00","IT:DKK":"DKK 0,00","IT:CHF":"CHF 0,00","IT:EUR":"€ 0,00","IT:AUD":"$ 0,00","IT:RMB":"¥ 0,00","IT:HKD":"HKD$ 0,00","IT:NZD":"NZD$ 0,00","IT:SGD":"SGD$ 0,00","IT:TWD":"NT$ 0,00","IT:RUB":"руб. 0,00","ES:GBP":"0,00 £","ES:USD":"0,00 $","ES:CAD":"0,00 C$","ES:SEK":"0,00 SEK","ES:NOK":"0,00 NOK","ES:DKK":"0,00 DKK","ES:CHF":"0,00 CHF","ES:EUR":"0,00 €","ES:AUD":"0,00 $","ES:RMB":"0,00 ¥","ES:HKD":"0,00 HKD$","ES:NZD":"0,00 NZD$","ES:SGD":"0,00 SGD$","ES:TWD":"0,00 NT$","ES:RUB":"0,00 руб.","AU:GBP":"£0.00","AU:USD":"$0.00","AU:CAD":"C$0.00","AU:SEK":"SEK0.00","AU:NOK":"NOK0.00","AU:DKK":"DKK0.00","AU:CHF":"CHF0.00","AU:EUR":"€0.00","AU:AUD":"$0.00","AU:RMB":"¥0.00","AU:HKD":"HKD$0.00","AU:NZD":"NZD$0.00","AU:SGD":"SGD$0.00","AU:TWD":"NT$0.00","AU:RUB":"руб. 0.00","RU:GBP":"0,00£","RU:USD":"0,00$","RU:CAD":"0,00C$","RU:SEK":"0,00SEK","RU:NOK":"0,00NOK","RU:DKK":"0,00DKK","RU:CHF":"0,00CHF","RU:EUR":"0,00€","RU:AUD":"0,00$","RU:RMB":"0,00¥","RU:HKD":"0,00HKD$","RU:NZD":"0,00NZD$","RU:SGD":"0,00SGD$","RU:TWD":"0,00NT$","RU:RUB":"0,00 руб."}})),define("bagsdk/models/apiService",["jquery","uuid","bagsdk/config/configuration","bagsdk/global"],(function(t,e,n,o){function i(e){this.defaultOptions={contentType:"application/json",dataType:"json",headers:{"asos-c-plat":"Web","asos-c-name":"Asos.Commerce.Bag.Sdk","asos-c-ver":"9.0.0","asos-c-istablet":!1,"asos-c-ismobile":!1}},t.extend(!0,this.defaultOptions,e)}return i.prototype.setupRequestAjaxOptions=function(o,i,r){return o=t.extend(!0,{url:"",headers:{"asos-cid":e()}},this.defaultOptions,o||{}),n.xSiteOrigin&&i.withParam("x-site-origin",n.xSiteOrigin),o.type=i.method.toUpperCase(),o.url+=i.path,"object"==typeof r&&Object.keys(r).length&&(o.data=JSON.stringify(r)),o},i.prototype.successfulResponseHandler=function(t){return t},i.prototype.failedResponseHandler=function(t){const e=t.getResponseHeader("content-type")||t.getResponseHeader("Content-Type"),n=t.getResponseHeader("asos-bag-session-token");return 403===t.status&&Array.isArray(t.responseJSON)&&t.responseJSON.some((function(t){return"NotAuthorisedForProduct"===t.errorCode}))?[{errorCode:"NotAuthorisedForProduct"}]:401===t.status||403===t.status?[{errorCode:"BagDoesNotExist"}]:500===t.status&&""===n?[{errorCode:"BagSessionTokenIsInvalid"}]:e&&-1!==e.indexOf("json")?JSON.parse(t.responseText):e&&-1!==e.indexOf("plain")&&t.responseText?t.responseText:""},i.prototype.jQueryTransport=function(e){return new Promise(function(n,o){t.ajax(e).done(function(){n(this.successfulResponseHandler.apply(this,arguments))}.bind(this)).fail(function(){o(this.failedResponseHandler.apply(this,arguments))}.bind(this))}.bind(this))},i.prototype.request=function(t,e,n){const i=this.setupRequestAjaxOptions(n,t,e);return o.newrelic&&o.newrelic.interaction().save(),this.jQueryTransport(i)},i})),define("global",[],(function(){return window})),define("bagsdk/services/identityService",["bagsdk/config/configuration","global"],(function(t,e){const n=()=>t.getIdentitySdkDelegate();return{customerGuid:function(){return n().then((function(t){return t.customer.customerGuid()}))},customerId:function(){return n().then((function(t){return t.customer.customerId()}))},customerAnonymousId:function(){return n().then((function(t){return t.customer.anonymousId()}))},getAuthHeader:function(){return n().then((function(t){return t.getAuthHeader({timeoutMs:15e3,retries:0})}))},isAuthenticated:function(){return n().then((function(t){return t.customer.isAuthenticated()}))},login:function(){return n().then((function(t){return t.login()}))},onSessionEnded:function(t){e.addEventListener("AsosAuthClient.onLoggedOut",t)}}})),define("bagsdk/exceptions/bagSdkException",[],(function(){function t(t,e){return!!Array.isArray(t)&&t.some((function(t){return t.errorCode===e}))}function e(e){this.name="BagSdkException",this.message=e,this.stack=(new Error).stack,this.bagStateInvalid=t(e,"BagItemDoesNotExist")||t(e,"ProductNotAvailableFromProductService")}return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e})),define("bagsdk/factories/memoryCacheFactory",[],(function(){const t={};function e(t){this.storage=t}return e.prototype.getItem=function(t){let e;const n=this.storage[t];return n&&(n.expires>(new Date).getTime()||!n.expires?e=n.value:(delete this.storage[t],e=null)),e},e.prototype.removeItem=function(t){this.storage[t]&&delete this.storage[t]},e.prototype.setItem=function(t,e,n){const o=1e3*n||0;this.storage[t]={value:e,expires:o?(new Date).getTime()+o:o}},e.prototype.clear=function(){this.storage={}},function(){return{application:new e(t),instance:new e({})}}})),define("bagsdk/services/persistedDataService",["global"],(function(t){function e(t){this.storage=t,this.storageKey="Asos.Commerce.Bag.Sdk",this.cleanCache()}return e.prototype.cleanCache=function(){const t=this.getStorageItem(),e={};for(const n in t)if(_objectHasOwn(t,n)){const o=t[n];_objectHasOwn(o,"expires")&&o.expires>(new Date).getTime()&&(e[n]=o)}this._setStorageItem(this.storageKey,JSON.stringify(e))},e.prototype.getStorageItem=function(){const t=this.storage.getItem(this.storageKey);return t?JSON.parse(t):{}},e.prototype.getItem=function(t){const e=this.getStorageItem();if(_objectHasOwn(e,t)){const n=e[t];if(n.expires>(new Date).getTime())return n.data;this.deleteItem(t)}return null},e.prototype.setItem=function(t,e,n){n=void 0===n?36e5:n;const o=this.getStorageItem();o[t]={data:e,expires:(new Date).getTime()+n},this._setStorageItem(this.storageKey,JSON.stringify(o))},e.prototype.deleteItem=function(t){const e=this.getStorageItem();delete e[t],this._setStorageItem(this.storageKey,JSON.stringify(e))},e.prototype.clear=function(){this._setStorageItem(this.storageKey,JSON.stringify({}))},e.prototype._setStorageItem=function(e,n){try{this.storage.setItem(e,n)}catch(e){t.console.warn("Error setting localStorage:",e)}},new e(t.localStorage)})),define("bagsdk/services/cookieService",["bagsdk/global","jquery"],(function(t,e){function n(){return new Date}function o(){const e=new RegExp(/(?:.)*?\.?asos(.+)/);return t.location.hostname.replace(e,"asos$1")}function i(e,i,r){const s=o();let a="";if(r){const t=n();t.setTime(t.getTime()+24*r*60*60*1e3),a="; expires="+t.toGMTString()}t.document.cookie=e+"="+i+a+";path=/;domain="+s}const r=function(t,n,o){const i={};if(t){const r=t.split(n);for(let t=0;t<r.length;t++){const n=r[t].indexOf(o);i[e.trim(r[t].substr(0,n))]=r[t].substr(n+1)}}return i},s=function(e){const n=r(t.document.cookie,";","=");let o="";return e in n&&(o=n[e]),decodeURIComponent(o)};return{readCookie:s,writeToCookie:function(t,e,n,o){const a=function(t){const e=s(t);return r(e,"&","=")}(t);a[e]=encodeURIComponent(n);const c=function(t,e,n){const o=[];for(const e in t)_objectHasOwn(t,e)&&o.push(e+n+t[e]);return o.join(e)}(a,"&","=");i(t,c,o)},writeCookie:function(t,e,n){i(t,e,n)},getCookieDomain:o,getDate:n,invalidateCookieByPrefix:function(e){t.document.cookie.split(/;\s*/).filter((function(t){return t.match(e+"[^=]*=")})).forEach(function(t){const e=t.split("=")[0];this.writeCookie(e,"null",-1)}.bind(this))}}})),define("bagsdk/services/bagApiService",["bagsdk/models/apiService","bagsdk/services/identityService","bagsdk/exceptions/bagSdkException","bagsdk/factories/memoryCacheFactory","bagsdk/services/persistedDataService","bagsdk/services/cookieService"],(function(t,e,n,o,i,r){function s(e){t.call(this,{url:e.bagApiUrl,headers:{"asos-c-store":e.store}}),this.memoryCache=o(),this.keyCreator=e.keyCreator;let n=null,s=null;this.setBagId=function(t){const e=this.keyCreator.createCookieKey("BagId");n=t,r.writeCookie(e,t,2/24)},this.readLastModifiedCookie=function(){const t=this.keyCreator.createCookieKey("BagLastModified"),e=parseInt(r.readCookie(t),10);return isNaN(e)?null:e},this.setLastModifiedCookie=function(t,e){const n=this.keyCreator.createCookieKey("BagLastModified");s=t,r.writeCookie(n,s,e)},this.updatePersistedLastModified=function(t){const e=this.keyCreator.createPersistedDataKey({customerAnonymousId:t,keyName:"bagLastModified"}),n=Date.now();i.setItem(e,n),this.setLastModifiedCookie(n,1/24)},this.getBagId=function(){return n},this.setOrigin=function(t){r.writeCookie("BagOrigin",t,2/24)},this.getOrigin=function(){return r.readCookie("BagOrigin")||null},this.setSessionToken=function(t){r.writeCookie("asos-bag-session-token",t)},this.getSessionToken=function(){return r.readCookie("asos-bag-session-token")||null}}return s.prototype=Object.create(t.prototype),s.prototype.constructor=s,s.prototype.setupRequestAjaxOptions=function(){const e=t.prototype.setupRequestAjaxOptions.apply(this,arguments),n=this.getOrigin();n&&(e.headers=e.headers||{},e.headers["asos-bag-origin"]=n);const o=this.getSessionToken();return o&&(e.headers=e.headers||{},e.headers["asos-bag-session-token"]=o),e},s.prototype.successfulResponseHandler=function(t,e,n){const o=function(t,e){return t.bag&&t.bag.origin?t.bag.origin:e.getResponseHeader("asos-bag-origin")}(t,n);o&&this.setOrigin(o);const i=n.getResponseHeader("asos-bag-session-token");i&&this.setSessionToken(i);const r=function(t){return t.bag&&t.bag.id?t.bag.id:t.bagId}(t);return r&&this.setBagId(r),t},s.prototype.exceptionHandler=function(t){throw Array.isArray(t)?(t[0]&&"BagSessionTokenIsInvalid"===t[0].errorCode&&r.invalidateCookieByPrefix("asos-bag-session-token"),new n(t)):new Error(t)},s.prototype.request=function(n,o,s){return Promise.all([e.getAuthHeader(),e.customerAnonymousId()]).then(function(e){const a=e[0],c=e[1],u={headers:{Authorization:a}};return s&&(u.headers["asos-bag-product-authorization"]=s),t.prototype.request.call(this,n,o,u).then(function(t){const e=(t=t||{}).bag?t.bag.summary:t,n=!!t.bag;if(function(t){r.writeToCookie("asosbasket","basketitemcount",t.totalQuantity,1/24),r.writeToCookie("asosbasket","basketitemtotalretailprice",t.totalPrice?t.totalPrice.value:void 0,1/24)}(e),n){const e=this.keyCreator.createMemoryCacheKey({keyName:"bag"});this.memoryCache.application.setItem(e,t,20)}const o=this.keyCreator.createPersistedDataKey({customerAnonymousId:c,keyName:"summary"}),s=this.keyCreator.createPersistedDataKey({customerAnonymousId:c,keyName:"bagId"});return i.setItem(o,e,3e5),i.setItem(s,e.bagId,72e5),this.updatePersistedLastModified(c),t}.bind(this))}.bind(this)).catch(this.exceptionHandler.bind(this))},s})),define("bagsdk/config/routes",[],(function(){return{commerceBag:{createBagByCustomer:{path:"/commerce/bag/v4/customers/:guid/bags/getbag",method:"post"},getBagByCustomerAndStore:{path:"/commerce/bag/v4/customers/:guid/stores/:store/bag",method:"get"},getBagByCustomer:{path:"/commerce/bag/v4/customers/:guid/countries/:country/bag",method:"get"},getBagSummaryByCustomerAndStore:{path:"/commerce/bag/v4/customers/:guid/stores/:store/bag/total",method:"get"},getBagSummaryByCustomer:{path:"/commerce/bag/v4/customers/:guid/countries/:country/bag/total",method:"get"},getBagById:{path:"/commerce/bag/v4/bags/:bagId",method:"get"},getBagSummaryById:{path:"/commerce/bag/v4/bags/:bagId/total",method:"get"},addVariant:{path:"/commerce/bag/v4/bags/:bagId/product",method:"post"},removeItem:{path:"/commerce/bag/v4/bags/:bagId/product/:itemId",method:"delete"},removeSubscription:{path:"/commerce/bag/v4/bags/:bagId/subscription/:itemId",method:"delete"},removeVoucher:{path:"/commerce/bag/v4/bags/:bagId/vouchers/:itemId",method:"delete"},updateItem:{path:"/commerce/bag/v4/bags/:bagId/product/:itemId/update",method:"post"},moveToBag:{path:"/commerce/bag/v4/bags/:bagId/products/save",method:"post"},saveBag:{path:"/commerce/bag/v4/bags/:bagId/items/save",method:"post"},saveBagItem:{path:"/commerce/bag/v4/bags/:bagId/items/:itemId/save",method:"post"},updateCurrency:{path:"/commerce/bag/v4/bags/:bagId/currency",method:"put"},setDeliveryOption:{path:"/commerce/bag/v4/bags/:bagId/deliveryoptions",method:"put"},addVoucher:{path:"/commerce/bag/v4/bags/:bagId/vouchers",method:"post"},updateVoucher:{path:"/commerce/bag/v4/bags/:bagId/vouchers/:itemId",method:"put"},addSubscription:{path:"/commerce/bag/v4/bags/:bagId/subscription",method:"post"}}}})),define("bagsdk/models/route",["bagsdk/global"],(function(t){function e(t,e){this.path=t,this.method=e}return e.prototype.withExpansions=function(e){return this.path=function(n){if(-1===n.indexOf("?")?n+="?":n+="&",n+="expand=",Array.isArray(e)){for(let o=0;o<e.length-1;o++)n+=t.escape(e[o])+",";n+=t.escape(e[e.length-1])}else n+=t.escape(e);return n}(this.path),this},e.prototype.withParam=function(e,n){var o;return this.path=(-1===(o=this.path).indexOf("?")?o+="?":o+="&",o+=t.escape(e)+"="+t.escape(n)),this},e})),define("bagsdk/services/routeService",["bagsdk/config/routes","bagsdk/models/route"],(function(t,e){const n=t.commerceBag;return{createRoute:function(o,i,r){const s=function(e){let o=n;if(e&&e.routeCollection){if(!t[e.routeCollection])throw new Error('Unknown routeCollection "'+e.routeCollection+'".');o=t[e.routeCollection]}return o}(r)[o];if(!s)throw new Error('Unknown route "'+o+'".');return new e(function(t,e){let n,o=t;for(const t in e)_objectHasOwn(e,t)&&(n=new RegExp(":"+t,"g"),o=o.replace(n,e[t]));return o}(s.path,i),s.method)}}})),define("bagsdk/services/notificationService",["jquery"],(function(t){const e="addToBag:",n="completed",o={addEventStart:e+"started",addEventCompleted:e+n,addEventError:e+"error",updateEventCompleted:"bagUpdated:"+n};function i(e,n,o){t(e).trigger(n,o)}function r(){}return r.prototype.notifyItemAddedToBagStart=function(t,e){i(t,o.addEventStart,e)},r.prototype.notifyItemAddedToBagComplete=function(t,e,n){i(t,o.addEventCompleted,[e,n])},r.prototype.notifyItemAddedToBagError=function(t,e){i(t,o.addEventError,e)},r.prototype.notifyBagUpdatedComplete=function(t,e,n,r){i(t,o.updateEventCompleted,[e,n,r])},new r})),define("bagsdk/utils/comparer",[],(function(){const t=function(t,e){const n=Object.keys(t),o=Object.keys(e);return n.length===o.length&&n.every((function(n){return t[n]===e[n]}))};return{areConfigurationsEqual:function(e,n){return t(e,n)},areContextsEqual:function(e,n){return t(e,n)}}})),define("bagsdk/utils/keyCreator",[],(function(){function t(t,e,n){this._storeId=t,this._country=e,this._enableStoreBaseOperation=n}const e=function(t){return t.join(":::")};return t.prototype.createMemoryCacheKey=function(t){const n=[];return this._enableStoreBaseOperation||n.push(this._storeId),n.push(this._country),n.push(t.keyName),e(n)},t.prototype.createPersistedDataKey=function(t){const n=[];return n.push(t.customerAnonymousId),n.push(this._storeId),this._enableStoreBaseOperation||n.push(this._country),n.push(t.keyName),e(n)},t.prototype.createCookieKey=function(t){const e=[];return e.push(t),e.push(this._storeId),this._enableStoreBaseOperation||e.push(this._country),e.join(":")},t})),define("bagsdk/exceptions/bagSdkSingleInstanceMismatchError",["./bagSdkException"],(function(t){function e(){this.name="BagSdkSingleInstanceMismatchError",this.stack=(new Error).stack}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e})),define("bagsdk/exceptions/argumentError",["./bagSdkException"],(function(t){function e(t){this.name="ArgumentError",this.message=t,this.stack=(new Error).stack}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e})),define("bagSdk/sdk",["bagsdk/config/configuration","bagsdk/config/defaultConfiguration","bagsdk/config/currencies","bagsdk/services/bagApiService","bagsdk/factories/memoryCacheFactory","bagsdk/services/cookieService","bagsdk/services/identityService","bagsdk/services/routeService","bagsdk/services/persistedDataService","bagsdk/services/notificationService","bagsdk/utils/comparer","bagsdk/utils/keyCreator","bagsdk/utils/getInstanceEventBus","bagsdk/global","jquery","bagsdk/exceptions/bagSdkSingleInstanceMismatchError","bagsdk/exceptions/argumentError"],(function(t,e,n,o,i,r,s,a,c,u,d,h,g,m,p,l,f){const y={deliveryOptions:"getdeliveryoptions",summary:"summary",total:"total",variants:"variants"};function b(t){let e=[y.summary,y.total];return void 0!==t&&(e=e.concat(t)),e}function I(t,e){return null===e&&null===t||("object"!=typeof e||null!==t)&&((null!==e||"object"!=typeof t)&&e.id===t.id)}function C(t,e){if(void 0===t.seller)return!1;const n=e.bag.items;for(let e=0;e<n.length;e++)if(n[e].variantId===t.variantId){const o=n[e].seller;return void 0!==o&&!I(t.seller,o)}}function S(t){const e=t.bag.items;for(let t=0;t<e.length;t++)if(e[t].isHotProduct)return!0;return!1}function k(e){this._context=e,this._keyCreator=new h(e.storeId,e.country,e.enableStoreBasedOperation),this._bagApiService=new o({keyCreator:this._keyCreator,bagApiUrl:t.bagApiUrl,store:this._context.storeId}),this._memoryCache=i(),this._bindEventSubscriptions(),this._bagIdCookieKey=this._keyCreator.createCookieKey("BagId"),this._bagOriginCookieKey="BagOrigin",this._lastModifiedCookieKey=this._keyCreator.createCookieKey("BagLastModified"),this._keyStoreDataVersionKey="asos-b-sdv629",this._googleAnalyticsClientIdCookieName="asos-b-gat251",this._existingDataVersionCookie=r.readCookie(this._keyStoreDataVersionKey),this._computeKeyStoreDataVersion(),this._handlePendingHotProduct()}k.prototype._expansions=y,k.prototype._bindEventSubscriptions=function(){s.onSessionEnded(this._handleLogout.bind(this))},k.prototype._getUniqueUrlValue=function(){return(new Date).getTime()},k.prototype.version="9.0.0",k.prototype._init=function(){return Promise.all([s.customerGuid(),s.customerAnonymousId(),s.customerId()]).then(function(t){const e={customerGuid:t[0],customerAnonymousId:t[1],customerId:t[2]},n=this._keyCreator.createPersistedDataKey({customerAnonymousId:e.customerAnonymousId,keyName:"bagId"});let o=c.getItem(n);return o||(o=r.readCookie(this._bagIdCookieKey)||null),e.bagId=o,e}.bind(this))},k.prototype._prepareBag=function(t){return new Promise(function(e,n){if(null===t.bagId)return this._createBag().then((function(n){t.bagId=n.bag.id,e(t)})).catch((function(t){n(t)}));e(t)}.bind(this))},k.prototype.getCustomerConfig=function(){return new Promise(function(t){t({country:this._context.originCountry,currency:this._context.currency})}.bind(this))},k.prototype._getCurrencyNillValueByStoreAndCurrencyCode=function(t,e){const o=[t=t||"",e=e||""].join(":");return _objectHasOwn(n,o)?n[o]:"0.00"},k.prototype._bagDoesNotExist=function(t){return!!(t&&"object"==typeof t&&Array.isArray(t.message)&&t.message.filter((function(t){return"BagDoesNotExist"===t.errorCode||"BagDoesNotExistForCustomer"===t.errorCode})).length)},k.prototype._handleBagDoesNotExist=function(t,e){e&&this._bagDoesNotExist(t)&&this._invalidateCachesAndCookies(e)},k.prototype._invalidateCaches=function(t){["summary","bagId","bagLastModified","isLoggedIn"].forEach(function(e){const n=this._keyCreator.createPersistedDataKey({customerAnonymousId:t,keyName:e});c.deleteItem(n)}.bind(this))},k.prototype._invalidateCachesAndCookies=function(t){t?this._invalidateCaches(t):c.clear(),r.invalidateCookieByPrefix("BagId"),r.invalidateCookieByPrefix("BagLastModified"),r.invalidateCookieByPrefix("asos-bag-session-token"),m.asos.sdk=m.asos.sdk||{},m.asos.sdk.features&&m.asos.sdk.features.getFeature("bag-keep-bag-affinity-cookie").isEnabled()||r.invalidateCookieByPrefix("BagOrigin")},k.prototype.setSessionToken=function(t){this._bagApiService.setSessionToken(t)},k.prototype.getSessionToken=function(){return this._bagApiService.getSessionToken()},k.prototype.getOrCreateBag=function(t){return this.getBag().catch(function(e){if(this._bagDoesNotExist(e))return this._createBag(t);throw e}.bind(this))},k.prototype.getBag=function(t){const e=this._memoryCache.application.getItem(this._keyCreator.createMemoryCacheKey({keyName:"bag"}));return e?new Promise((function(t){t(e)})):this._init().then(function(e){if(null!==e.bagId)return this._getBagById(e.bagId,t,e.customerAnonymousId);const n=e.customerId||e.customerGuid;return this._getBagByCustomerId(n,t,e.customerAnonymousId)}.bind(this))},k.prototype.getBagById=function(t,e){return this._init().then(function(n){return this._getBagById(t,e,n.customerAnonymousId)}.bind(this))},k.prototype._getBagById=function(t,e,n){const o=a.createRoute("getBagById",{bagId:t}).withExpansions(b(e)).withParam("lang",this._context.language).withParam("cb",this._getUniqueUrlValue());return this._bagApiService.request(o).then(this._validateBagCurrency.bind(this,e)).then(function(t){return u.notifyBagUpdatedComplete(this,"bagRetrieved",t),t}.bind(this)).catch(function(t){throw this._handleBagDoesNotExist(t,n),t}.bind(this))},k.prototype.getBagByCustomer=function(t){return this._init().then(function(e){const n=e.customerId||e.customerGuid;return this._getBagByCustomerId(n,t,e.customerAnonymousId)}.bind(this))},k.prototype._getBagByCustomerId=function(t,e,n){const o=this._constructGetBagByCustomerIdRoute(t,e);return this._bagApiService.request(o).then(this._validateBagCurrency.bind(this,e)).then(function(t){return u.notifyBagUpdatedComplete(this,"bagRetrieved",t),t}.bind(this)).catch(function(t){throw this._handleBagDoesNotExist(t,n),t}.bind(this))},k.prototype._constructGetBagByCustomerIdRoute=function(t,e){let n;return n=this._context.enableStoreBasedOperation?a.createRoute("getBagByCustomerAndStore",{guid:t,store:this._context.storeId}):a.createRoute("getBagByCustomer",{guid:t,country:this._context.country}).withParam("keyStoreDataversion",this._context.keyStoreDataversion),n.withParam("lang",this._context.language).withParam("cb",this._getUniqueUrlValue()).withExpansions(b(e))},k.prototype._createBag=function(t){return this._init().then(function(e){const n={currency:this._context.currency,lang:this._context.language,sizeSchema:this._context.sizeSchema},o=a.createRoute("createBagByCustomer",{guid:e.customerId||e.customerGuid}).withExpansions(b(t)).withParam("lang",this._context.language);return this._context.enableStoreBasedOperation?(n.country=this._context.originCountry,n.store=this._context.storeId):(o.withParam("keyStoreDataversion",this._context.keyStoreDataversion),n.country=this._context.country,n.originCountry=this._context.originCountry),this._bagApiService.request(o,n)}.bind(this))},k.prototype._getCachedSummary=function(t){if(this._bagModified(t))return null;const e=this._keyCreator.createPersistedDataKey({customerAnonymousId:t,keyName:"summary"});return c.getItem(e)},k.prototype._getCachedLastModified=function(t){const e=this._keyCreator.createPersistedDataKey({customerAnonymousId:t,keyName:"bagLastModified"});return c.getItem(e)},k.prototype.getNillBagSummary=function(t){return{bagId:null,currency:t,totalPrice:{text:this._getCurrencyNillValueByStoreAndCurrencyCode(this._context.storeId,t),value:0},totalQuantity:0}},k.prototype._bagModified=function(t){return this._getCachedLastModified(t)!==this._bagApiService.readLastModifiedCookie()},k.prototype.getBagSummary=function(){const t=function(t){let e;if(null!==t.bagId)e=a.createRoute("getBagSummaryById",{bagId:t.bagId});else{const n={guid:t.customerId||t.customerGuid};!0===this._context.enableStoreBasedOperation?(n.store=this._context.storeId,e=a.createRoute("getBagSummaryByCustomerAndStore",n)):(n.country=this._context.country,e=a.createRoute("getBagSummaryByCustomer",n),e.withParam("keyStoreDataversion",this._context.keyStoreDataversion))}return e.withParam("lang",this._context.language).withParam("cb",this._getUniqueUrlValue()),e};return this._init().then(function(e){const n=this._getCachedSummary(e.customerAnonymousId);if(n&&n.bagId===e.bagId)return n;const o=t.call(this,e);return this._bagApiService.request(o).catch(function(t){this._handleBagDoesNotExist(t,e.customerAnonymousId);const n=this.getNillBagSummary(this._context.currency),o=this._keyCreator.createPersistedDataKey({customerAnonymousId:e.customerAnonymousId,keyName:"summary"});return c.setItem(o,n),n}.bind(this))}.bind(this)).then(this._validateBagSummaryCurrency.bind(this))};const _=function(t,e,n){const o={variantId:t,setTime:(new Date).getTime(),savedItemId:e,seller:n};return window.localStorage.setItem("pendingHotProductId",JSON.stringify(o)),s.login()},v=function(t,e,n){return this._init().then(this._prepareBag.bind(this)).then(function(o){const i=a.createRoute("addVariant",{bagId:o.bagId}).withExpansions(b(e)).withParam("lang",this._context.language),r={variantId:t.variantId};return this._bagApiService.request(i,r,t.productAuthorization).then(function(e){const o={sellerChanged:C(t,e),containsHotProduct:S(e)},i=p.extend({},n,o);return u.notifyItemAddedToBagComplete(this,e,i),u.notifyBagUpdatedComplete(this,"itemAdded",e,i),e}.bind(this)).catch(function(e){throw"NotAuthorisedForProduct"===e.message[0].errorCode?_.call(this,t.variantId,void 0,t.seller):this._handleBagDoesNotExist(e,o.customerAnonymousId),e}.bind(this))}.bind(this))};k.prototype.addVariant=function(t,e,n){return new Promise(function(o,i){u.notifyItemAddedToBagStart(this,t.variantId);const r=v.bind(this,t,e,n);r().then(o).catch(function(t){this._bagDoesNotExist(t)?r().then(o).catch((function(t){u.notifyItemAddedToBagError(this,t),i(t)})):(u.notifyItemAddedToBagError(this,t),i(t))}.bind(this))}.bind(this))},k.prototype.removeItem=function(t,e,n){return this._init().then(this._prepareBag.bind(this)).then(function(o){let i;switch(e){case"subscription":i="removeSubscription";break;case"voucher":i="removeVoucher";break;default:i="removeItem"}const r=a.createRoute(i,{bagId:o.bagId,itemId:t}).withExpansions(b(n)).withParam("lang",this._context.language);return this._bagApiService.request(r).then(function(t){return u.notifyBagUpdatedComplete(this,"removeItem",t),t}.bind(this)).catch(function(t){throw this._handleBagDoesNotExist(t,o.customerAnonymousId),t}.bind(this))}.bind(this))},k.prototype.updateItem=function(t,e,n,o){return this._init().then(this._prepareBag.bind(this)).then(function(i){const r={bagId:i.bagId,itemId:t},s=a.createRoute("updateItem",r).withExpansions(b(o)).withParam("lang",this._context.language);return this._bagApiService.request(s,{quantity:n,variantId:e}).then(function(t){return u.notifyBagUpdatedComplete(this,"updateItem",t),t}.bind(this)).catch(function(t){throw this._handleBagDoesNotExist(t,i.customerAnonymousId),t}.bind(this))}.bind(this))};const B=function(t,e,n){return this._init().then(this._prepareBag.bind(this)).then(function(o){const i=a.createRoute("moveToBag",{bagId:o.bagId}).withExpansions(b(e)).withParam("lang",this._context.language),r=[{variantId:t.variantId}],s=parseInt(t.savedItemId,10);return isNaN(s)||(r[0].savedItemId=s),this._bagApiService.request(i,r).then(function(e){const o={sellerChanged:C(t,e),containsHotProduct:S(e)},i=p.extend({},n,o);return u.notifyItemAddedToBagComplete(this,e,i),u.notifyBagUpdatedComplete(this,"itemAdded",e,i),e}.bind(this)).catch(function(e){if("NotAuthorisedForProduct"===e.message[0].errorCode)return _.call(this,t.variantId,s,t.seller).then(function(){throw e}.bind(this));throw this._handleBagDoesNotExist(e,o.customerAnonymousId),e}.bind(this))}.bind(this))};k.prototype.moveToBag=function(){let t,e,n;return"number"==typeof arguments[0]?(t={},t.variantId=arguments[0],t.savedItemId=arguments[1],e=arguments[2],n=arguments[3]):(t=arguments[0],e=arguments[1],n=arguments[2]),new Promise(function(o,i){u.notifyItemAddedToBagStart(this,t.variantId);const r=B.bind(this,t,e,n);r().then(o).catch(function(t){this._bagDoesNotExist(t)?r().then(o).catch((function(t){u.notifyItemAddedToBagError(this,t),i(t)})):(u.notifyItemAddedToBagError(this,t),i(t))}.bind(this))}.bind(this))},k.prototype.saveBag=function(t){return this._init().then(this._prepareBag.bind(this)).then(function(e){const n={bagId:e.bagId},o=a.createRoute("saveBag",n).withExpansions(b(t)).withParam("lang",this._context.language);return this._bagApiService.request(o).then(function(t){return u.notifyBagUpdatedComplete(this,"saveBag",t),t}.bind(this)).catch(function(t){throw this._handleBagDoesNotExist(t,e.customerAnonymousId),t}.bind(this))}.bind(this))},k.prototype.saveForLater=function(t,e){return this._init().then(this._prepareBag.bind(this)).then(function(n){const o={bagId:n.bagId,itemId:t},i=a.createRoute("saveBagItem",o).withExpansions(b(e)).withParam("lang",this._context.language);return this._bagApiService.request(i).then(function(t){return u.notifyBagUpdatedComplete(this,"saveForLater",t),t}.bind(this)).catch(function(t){throw this._handleBagDoesNotExist(t,n.customerAnonymousId),t}.bind(this))}.bind(this))},k.prototype._computeKeyStoreDataVersion=function(){const t=this._context.keyStoreDataversion||"NO_KEY_STORE_DATAVERSION";this._existingDataVersionCookie!==t&&this._invalidateCachesAndCookies(),r.writeCookie(this._keyStoreDataVersionKey,t,.25)},k.prototype.updateCurrency=function(t,e){return this._init().then(function(n){if(!n.bagId)return new Promise(function(e){const o=this.getNillBagSummary(t),i=this._keyCreator.createPersistedDataKey({customerAnonymousId:n.customerAnonymousId,keyName:"summary"});c.setItem(i,o),this._context.currency=t,e(null)}.bind(this));const o={bagId:n.bagId},i=a.createRoute("updateCurrency",o).withExpansions(b(e)).withParam("lang",this._context.language);return this._bagApiService.request(i,{currency:t}).then(function(e){return this._context.currency=t,u.notifyBagUpdatedComplete(this,"updateCurrency",e),e}.bind(this)).catch(function(t){throw this._handleBagDoesNotExist(t,n.customerAnonymousId),t}.bind(this))}.bind(this))},k.prototype.setDeliveryOption=function(t,e){return this._init().then(this._prepareBag.bind(this)).then(function(n){const o={bagId:n.bagId},i=a.createRoute("setDeliveryOption",o).withExpansions(y.deliveryOptions).withParam("lang",this._context.language),r={deliveryOptionId:t};return void 0!==e&&(r.nominatedDate=e),this._bagApiService.request(i,r).then(function(t){return u.notifyBagUpdatedComplete(this,"setDeliveryOption",t),t}.bind(this)).catch(function(t){throw this._handleBagDoesNotExist(t,n.customerAnonymousId),t}.bind(this))}.bind(this))};const D=function(t,e,n,o,i,r,s){return this._init().then(this._prepareBag.bind(this)).then(function(c){const d={bagId:c.bagId},h=a.createRoute("addVoucher",d).withExpansions(b(s)).withParam("lang",this._context.language),g={Value:t,ToName:e,ToEmail:n,VoucherStyleId:o,DeliveryDate:i};return r&&(r.fromName&&(g.FromName=r.fromName),r.personalMessage&&(g.PersonalMessage=r.personalMessage)),this._bagApiService.request(h,g).then(function(t){return u.notifyBagUpdatedComplete(this,"addVoucher",t),t}.bind(this)).catch(function(t){throw this._handleBagDoesNotExist(t,c.customerAnonymousId),t}.bind(this))}.bind(this))};k.prototype.addVoucher=function(t,e,n,o,i,r,s){return new Promise(function(a,c){const u=D.bind(this,t,e,n,o,i,r,s);u().then(a).catch(function(t){this._bagDoesNotExist(t)?u().then(a).catch(c):c(t)}.bind(this))}.bind(this))},k.prototype.updateVoucher=function(t,e,n,o,i,r,s,c){return this._init().then(this._prepareBag.bind(this)).then(function(d){const h={bagId:d.bagId,itemId:t},g=a.createRoute("updateVoucher",h).withExpansions(b(c)).withParam("lang",this._context.language),m={Value:e,ToName:n,ToEmail:o,VoucherStyleId:i,DeliveryDate:r};return s&&(s.fromName&&(m.FromName=s.fromName),s.personalMessage&&(m.PersonalMessage=s.personalMessage)),this._bagApiService.request(g,m).then(function(t){return u.notifyBagUpdatedComplete(this,"updateVoucher",t),t}.bind(this)).catch(function(t){throw this._handleBagDoesNotExist(t,d.customerAnonymousId),t}.bind(this))}.bind(this))};const A=function(t,e){return this._init().then(this._prepareBag.bind(this)).then(function(n){const o={bagId:n.bagId},i=a.createRoute("addSubscription",o).withExpansions(b(e)).withParam("lang",this._context.language);return this._bagApiService.request(i,{SubscriptionId:t}).then(function(t){return u.notifyBagUpdatedComplete(this,"addSubscription",t),t}.bind(this)).catch(function(t){throw this._handleBagDoesNotExist(t,n.customerAnonymousId),t}.bind(this))}.bind(this))};function E(t,e){const n=r.readCookie(t),o=r.readCookie(e);return!(!n||!o||"null"===n||"null"===o)}function x(t,e,n){return new Promise(function(o,i){const r=this._context.currency;e!==r?this.updateCurrency(r,n).then((function(t){o(t)})).catch((function(t){i(t)})):o(t)}.bind(this))}function w(t){return Promise.resolve(t&&t.bag&&t.bag.summary?t.bag.summary:t)}k.prototype.addSubscription=function(t,e){return new Promise(function(n,o){const i=A.bind(this,t,e);i().then(n).catch(function(t){this._bagDoesNotExist(t)?i().then(n).catch(o):o(t)}.bind(this))}.bind(this))},k.prototype._saveGoogleAnalyticsClientId=function(){return m.ga&&m.ga(function(t){const e=t.get("clientId");r.writeCookie(this._googleAnalyticsClientIdCookieName,e)}.bind(this)),!0},k.prototype.startCheckout=function(){return new Promise(function(t,e){this._init().then(this._ensureCheckoutValues.bind(this)).then(function(t){this._invalidateCaches(t.customerAnonymousId)}.bind(this)).then(this._saveGoogleAnalyticsClientId.bind(this)).then(t.bind(this)).catch(e)}.bind(this))},k.prototype._ensureCheckoutValues=function(t){return new Promise(function(e,n){E(this._bagIdCookieKey,this._bagOriginCookieKey)?e(t):this.getBag().then(function(){if(E(this._bagIdCookieKey,this._bagOriginCookieKey))e(t);else{const t=function(t,e){const n=r.readCookie(t),o=r.readCookie(e),i=!!n&&"null"!==n,s=!!o&&"null"!==o;let a="StartCheckout:CookieCheckFailed";return i||s?i&&!s?a="StartCheckout:MissingBagOrigin":!i&&s&&(a="StartCheckout:MissingBagId"):a="StartCheckout:MissingBagOriginAndId",a}(this._bagIdCookieKey,this._bagOriginCookieKey);n(new Error(t))}}.bind(this)).catch((function(t){let e="";"object"==typeof t&&Array.isArray(t.message)&&t.message.length>0&&(e=":"+t.message[0].errorCode),n(new Error("StartCheckout:GetBagFailed"+e))}))}.bind(this))},k.prototype._handlePendingHotProduct=function(){return this._init().then(function(){const t=window.localStorage.getItem("pendingHotProductId"),e=JSON.parse(t),n=(new Date).getTime();if(e){if(n>=e.setTime+36e5)return window.localStorage.removeItem("pendingHotProductId");s.isAuthenticated().then(function(t){t&&(e.savedItemId?this.moveToBag({variantId:e.variantId,savedItemId:e.savedItemId,seller:e.seller},void 0,{initiator:"bagSdk"}):this.addVariant({variantId:e.variantId,seller:e.seller},void 0,{initiator:"bagSdk"})),window.localStorage.removeItem("pendingHotProductId")}.bind(this))}}.bind(this))},k.prototype._handleLogout=function(){this._memoryCache.application.clear(),this._invalidateCachesAndCookies(),r.writeCookie(this._keyStoreDataVersionKey,"null",-1)},k.prototype._validateBagCurrency=function(t,e){return x.call(this,e,e.bag.currency,t)},k.prototype._validateBagSummaryCurrency=function(t){return this._init().then(function(e){return x.call(this,t,t.currency).then(w).then(function(t){return null===t?this._getCachedSummary(e.customerAnonymousId):t}.bind(this))}.bind(this))},m.asos=m.asos||{},m.asos.commerce=m.asos.commerce||{};let K=null;return m.asos.commerce.bagSdk={getInstance:function(n,o){!function(t){if(!t)throw new f("context is required");if(!0===t.enableStoreBasedOperation){if(t.keyStoreDataversion)throw new f("invalid use of context.keyStoreDataversion")}else if(!t.keyStoreDataversion)throw new f("context.keyStoreDataversion is required");["storeId","country","originCountry","currency","language","sizeSchema"].forEach((function(e){if(!t[e])throw new f("context."+e+" is required")}))}(n);const i=p.extend({},n,{currency:n.currency});if(K){let n=p.extend({},o);if(function(t){for(const e in t)null===t[e]&&delete t[e]}(n),n=p.extend({},e,n),d.areContextsEqual(i,K._context)&&d.areConfigurationsEqual(n,t))return K;throw new l}return p.extend(t,e,o),K=new k(i),m.asos.commerce._bagSdkInstance=K,g.trigger("bagSdk:instanceReady"),g.bagSdkInstantiated=!0,K}},m.asos.commerce.bagSdk}));